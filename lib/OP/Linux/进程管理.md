# Linux进程管理
<!-- toc -->

* 程序：程序是静止的，程序就是磁盘上的一个文件。
* 进程：进程是一个正在执行的程序的实例，是动态的。
* 一旦程序被操作系统加载进内存了，那么这程序就成为了进程。
* PID：程序被操作系统加载到内存成为进程后动态分配的资源。每次加载的时候都是不同的，PID是唯一的，一个PID只标识一个进程。
* PPID：程序的父进程号，对于一个普通的用户进程，它的父进程就是执行它的哪个Shell，对于Linux而言，Shell就是bash。

## ps

ps命令用于报告当前系统的`进程状态`（快照）。可以搭配`kill指令`随时中断、删除不必要的程序。ps命令是最基本同时也是非常强大的进程查看命令，使用该命令可以确定有哪些进程正在运行和运行的状态、进程是否结束、进程有没有僵死、哪些进程占用了过多的资源等等，总之大部分信息都是可以通过执行该命令得到的。它能捕获系统在某一事件的进程状态，如果想不断更新查看的这个状态，可以使用`top命令`。

ps命令支持三种使用的语法格式：（可混合使用）

* UNIX 风格，选项可以组合在一起，并且选项前必须有“-”连字符
* BSD 风格，选项可以组合在一起，但是选项前不能有“-”连字符
* GNU 风格的长选项，选项前有两个“-”连字符

> 由于ps命令能够支持的系统类型相当的多，所以可选参数多的离谱！(见尾部列表)

### 基础用法

```js
ps
```

默认会显示4列未排序信息。

* PID: 运行着的命令(CMD)的进程编号
* TTY: 命令所运行的位置（终端）
* TIME: 运行着的该命令所占用的CPU处理时间
* CMD: 该进程所运行的命令

![](https://ws1.sinaimg.cn/large/006tNbRwly1fx7voa5wb4j30f8048gme.jpg)

由于可选参数较多，放置在文章末尾。以下对几组常用指令进项展开讲解。

### ps -u

在需要查看特定用户进程的情况下，我们可以使用 -u 参数。比如我们要查看用户'root'的进程，可以通过下面的命令

```js
ps -u root
```

### ps -C

通过进程名和PID过滤。

```js
// 显示一个名为node的进程的信息
ps -C node

```
### ps -L

如果我们想知道特定进程的线程，可以使用-L 参数，后面加上特定的PID。

```js
ps -L 1213
```

### ps -aux

通过cpu和内存使用来过滤进程。

> cpu(cpu) / eme(内存)

```js
// 根据cpu使用升序排列并以 less 方式查看
ps -aux --sort -pcpu | less
// 根据 内存使用 来升序排序
ps -aux --sort -pmem

// 合成1个命令并只显示前10个结果
ps -aux --sort -pcpu,+pmem | head -n 10
```

### ps -ef | grep node

显示UID，`PPIP`，C与STIME栏位。可搭配管道操作符进一步筛选。

### PS可选参数

> 不同的Linux发行版下可用的参数和展现会有差异。

* -a：显示所有终端机下执行的程序，除了阶段作业领导者之外。
* a：显示现行终端机下的所有程序，包括其他用户的程序。
* -A：显示所有程序。
* -c：显示CLS和PRI栏位。
* c：列出程序时，显示每个程序真正的指令名称，而不包含路径，选项或常驻服务的标示。
* -C<指令名称>：指定执行指令的名称，并列出该指令的程序的状况。
* -d：显示所有程序，但不包括阶段作业领导者的程序。
* -e：此选项的效果和指定"A"选项相同。
* e：列出程序时，显示每个程序所使用的环境变量。
* -f：显示UID，PPIP,C与STIME栏位。
* f：用ASCII字符显示树状结构，表达程序间的相互关系。
* -g<群组名称>：此选项的效果和指定"-G"选项相同，当亦能使用阶段作业领导者的名称来指定。
* g：显示现行终端机下的所有程序，包括群组领导者的程序。
* -G<群组识别码>：列出属于该群组的程序的状况，也可使用群组名称来指定。
* h：不显示标题列。
* -H：显示树状结构，表示程序间的相互关系。
* -j或j：采用工作控制的格式显示程序状况。
* -l或l：采用详细的格式来显示程序状况。
* L：列出栏位的相关信息。
* -m或m：显示所有的执行绪。
* n：以数字来表示USER和WCHAN栏位。
* -N：显示所有的程序，除了执行ps指令终端机下的程序之外。
* -p<程序识别码>：指定程序识别码，并列出该程序的状况。
* p<程序识别码>：此选项的效果和指定"-p"选项相同，只在列表格式方面稍有差异。
* r：只列出现行终端机正在执行中的程序。
* -s<阶段作业>：指定阶段作业的程序识别码，并列出隶属该阶段作业的程序的状况。
* s：采用程序信号的格式显示程序状况。
* S：列出程序时，包括已中断的子程序资料。
* -t<终端机编号>：指定终端机编号，并列出属于该终端机的程序的状况。
* t<终端机编号>：此选项的效果和指定"-t"选项相同，只在列表格式方面稍有差异。
* -T：显示现行终端机下的所有程序。
* -u<用户识别码>：此选项的效果和指定"-U"选项相同。
* u：以用户为主的格式来显示程序状况。
* -U<用户识别码>：列出属于该用户的程序的状况，也可使用用户名称来指定。
* U<用户名称>：列出属于该用户的程序的状况。
* v：采用虚拟内存的格式显示程序状况。
* -V或V：显示版本信息。
* -w或w：采用宽阔的格式来显示程序状况。　
* x：显示所有程序，不以终端机来区分。
* X：采用旧式的Linux i386登陆格式显示程序状况。
* -y：配合选项"-l"使用时，不显示F(flag)栏位，并以RSS栏位取代ADDR栏位　。
* -<程序识别码>：此选项的效果和指定"p"选项相同。
* --cols<每列字符数>：设置每列的最大字符数。
* --columns<每列字符数>：此选项的效果和指定"--cols"选项相同。
* --cumulative：此选项的效果和指定"S"选项相同。
* --deselect：此选项的效果和指定"-N"选项相同。
* --forest：此选项的效果和指定"f"选项相同。
* --headers：重复显示标题列。
* --help：在线帮助。
* --info：显示排错信息。
* --lines<显示列数>：设置显示画面的列数。
* --no-headers：此选项的效果和指定"h"选项相同，只在列表格式方面稍有差异。
* --group<群组名称>：此选项的效果和指定"-G"选项相同。
* --Group<群组识别码>：此选项的效果和指定"-G"选项相同。
* --pid<程序识别码>：此选项的效果和指定"-p"选项相同。
* --rows<显示列数>：此选项的效果和指定"--lines"选项相同。
* --sid<阶段作业>：此选项的效果和指定"-s"选项相同。
* --tty<终端机编号>：此选项的效果和指定"-t"选项相同。
* --user<用户名称>：此选项的效果和指定"-U"选项相同。
* --User<用户识别码>：此选项的效果和指定"-U"选项相同。
* --version：此选项的效果和指定"-V"选项相同。
* --widty<每列字符数>：此选项的效果和指定"-cols"选项相同。

> 最常用的方法是`ps -aux`，然后再利用一个管道符号`|`导向到`grep`去查找特定的进程，然后再对特定
的进程进行操作。
* 默认`ps`展示的列数<br/>
![](https://ws1.sinaimg.cn/large/006tNbRwly1fx7voa5wb4j30f8048gme.jpg)
* `-aux`展示的列数
![](https://ws1.sinaimg.cn/large/006tNbRwly1fx8ltfgu1xj30ms05b3yp.jpg)
* `-ef`展示的列数
![](https://ws3.sinaimg.cn/large/006tNbRwly1fx8luh89sqj30im054dfy.jpg)

## kill

kill命令用来删除执行中的程序或工作。kill可将指定的信息送至程序。预设的信息为SIGTERM(15),可将指定程序终止。若仍无法终止该程序，可使用SIGKILL(9)信息尝试强制删除程序。程序或工作的编号可利用`ps指令`或`job指令`查看。

```js
kill [选项][参数]

// 示例
kill 324      // 结束324进程
kill -9 324   // 强制结束324进程
```

选项：
* -a：当处理当前进程时，不限制命令名和进程号的对应关系；
* -l <信息编号>：若不加<信息编号>选项，则-l参数会列出全部的信息名称；
* -p：指定kill 命令只打印相关进程的进程号，而不发送任何信号；
* -s <信息名称或编号>：指定要送出的信息；
* -u：指定用户。

参数：
* 进程或作业识别号：指定要删除的进程或作业。

### kill -l

列出所有信号名称。

![](https://ws4.sinaimg.cn/large/006tNbRwly1fx8q9tmtp2j316i0es44q.jpg)

只有第9种信号(SIGKILL)才可以无条件终止进程，其他信号进程都有权利忽略，下面是常用的信号：

```js
HUP     1    // 终端断线
INT     2    // 中断（同 Ctrl + C）
QUIT    3    // 退出（同 Ctrl + \）
TERM   15    // 终止
KILL    9    // 强制终止
CONT   18    // 继续（与STOP相反， fg/bg命令）
STOP   19    // 暂停（同 Ctrl + Z）
```

通常先用ps查找进程，然后用kill杀掉：

```js
ps -ef | grep vim
// root      3268  2884  0 16:21 pts/1    00:00:00 vim install.log
kill 3268
```

## killall

killall命令使用进程的名称来杀死进程，使用此指令可以`杀死一组同名进程`。我们可以使用kill命令杀死指定进程PID的进程，如果要找到我们需要杀死的进程，我们还需要在之前使用ps等命令再配合grep来查找进程，而killall把这两个过程合二为一，是一个很好用的命令。

```js
kill [选项][参数]

// 示例
kill vim      // 杀死vim相关进程
```

选项：
* -e：对长名称进行精确匹配；
* -l：忽略大小写的不同；
* -p：杀死进程所属的进程组；
* -i：交互式杀死进程，杀死进程前需要进行确认；
* -l：打印所有已知信号列表；
* -q：如果没有进程被杀死。则不输出任何信息；
* -r：使用正规表达式匹配要杀死的进程名称；
* -s：用指定的进程号代替默认信号“SIGTERM”；
* -u：杀死指定用户的进程。

参数：
* 指定要结束的进程名称。
